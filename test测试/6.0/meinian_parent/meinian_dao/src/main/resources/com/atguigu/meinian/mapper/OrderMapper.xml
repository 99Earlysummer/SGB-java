<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.atguigu.meinian.mapper.OrderMapper">
    <!--判断该会员是否预约了同一天的同一个套餐  如果有数量那就说明预约了多的    查询记录数
    int findCountByCondition(@Param("order") Order order);-->
<select id="findCountByCondition" resultType="int">
    select count(*)
    from t_order
where member_id=#{memberId} and orderDate=#{orderDate} and setmeal_id=#{setmealId}
</select>

    <!--Map findById(Integer id);-->
        <select id="findById" resultType="java.util.Map">
            select
                t_member.name member,
                t_setmeal.name setmeal,
                t_order.orderDate,
                t_order.orderType from t_order
                                           left join t_member
                                                     on t_order.member_id = t_member.id
                                           left join t_setmeal
                                                     on t_order.setmeal_id = t_setmeal.id
            where t_order.id = #{id}
    </select>

    <!--将预约信息存到数据库中

    void addOrder(Order order);-->
<insert id="addOrder"  useGeneratedKeys="true" keyProperty="id">
    insert into t_order
    values (
               null,
               #{memberId},
               #{orderDate},
               #{orderType},
               #{orderStatus},
               #{setmealId}
           )
</insert>

<!--    * 获取今日预约数
    Integer getTodayOrderNumber(@Param("orderDate") String reportDate);-->
    <!--Integer getTodayOrderNumber(@Param("orderDate") String reportDate);-->
    <select id="getTodayOrderNumber" resultType="int">
        select count(*) from t_order where orderDate = #{orderDate}
    </select>
    <!--    * 获取今日出游数
        Integer getTodayVisitsNumber(@Param("orderDate") String reportDate);-->
    <!--Integer getTodayVisitsNumber(@Param("orderDate") String reportDate);-->
    <select id="getTodayVisitsNumber" resultType="int">
        select count(*) from t_order where orderDate = #{orderDate} and orderStatus = '已出游'
    </select>
    <!-- * 查询本周或本月预约数
       Integer getThisWeekAndMonthOrderNumber(@Param("startDate") Date startDate, @Param("endDate") Date endDate);-->

    <!--Integer getThisWeekAndMonthOrderNumber(@Param("startDate") Date thisWeekMonday, @Param("endDate") Date thisWeekSunday);-->
    <select id="getThisWeekAndMonthOrderNumber" resultType="int">
        select count(*) from t_order where orderDate between #{startDate} and #{endDate}
    </select>
    <!--* 查询本周或本月出游数
       Integer getThisWeekAndMonthVisitsNumber(@Param("startDate") Date startDate, @Param("endDate") Date endDate);-->
    <!--Integer getThisWeekAndMonthVisitsNumber(@Param("startDate") Date startDate, @Param("endDate") Date endDate);-->
    <select id="getThisWeekAndMonthVisitsNumber" resultType="int">
        select count(*) from t_order where orderDate between #{startDate} and #{endDate} and orderStatus = '已出游'
    </select>
</mapper>